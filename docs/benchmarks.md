
## Введение

В данном документе приведен анализ быстродействия нескольких версий реализации алгоритма, закрепленных в данном репозитории. Реализации сравнивались как между собой, так и с сторонними высокопроизводительными решениями.

В качестве сторонних решений взяты реализации [Алексея Дягтерева (adegtyarev)](https://github.com/adegtyarev/streebog)  и [OpenSSL GOST Engine](https://github.com/gost-engine/engine).

Конфигурация окружения:  
- Ryzen 5 4000 Series
- OS Ubuntu 22.04
- g++ 11.4.0

## Бенчмарки

Список особенностей выбранных реализаций и их названий в документе приведен в таблице ниже:

|       Реализация        |   Название исполняемого файла    |                              Особенности                               |
| :---------------------: | :------------------------------: | :--------------------------------------------------------------------: |
|          v2.1           |            stbg512v21            |                Явно использует SSE/AVX<br>(ограниченно)                |
|   v2.2 <br>(metaprog)   |            stbg512v22            | Метапрограммирование <br>+ неявный SIMD<br>(компиляция с march=native) |
|   v2.3 <br>(metaprog)   |            stbg512v23            | Метапрограммирование<br>+ неявный SIMD<br>(компиляция с march=native)  |
| OpenSSL <br>GOST Engine | gost.so <br>(openssl engine lib) |                        Явно использует SSE/MMX                         |
|       adegtyarev        |          gost3411-2012           |                         Явно ипользует SSE/MMX                         |

> Версии v2.2 и v2.3 могут быть собраны в полностью SSE + AVX/AVX2 имплементации (директива `USE_MANUAL_AVX`, экспериментальная возможность); 
> Надпись (metaprog) уточняет, что использовалась именно главная сборка, основанная на метапрограммировании.


Бенчмаркинг проведен с помощью утилиты [hyperfine](https://github.com/sharkdp/hyperfine) для следующих задач:
1. Хеширование файлов обьемом до 100 МБ
2. Хеширование файлов обьемом от 100 МБ  до 1000 МБ
3. Хеширование обьемом от 1000 МБ

> Для более корректного сравнения все программы запускались с одинаковыми правами и приоритетом, получали предварительный "прогрев" процессора и кеша с помощью hyperfine параметра `--warmup`.

#### Хеширование файлов до 100 МБ
Использован файл обьемом 77 МБ (название - f77). 

Проверка корректности работы реализаций:

![Проверка корректности 1](docs/aux/b1_correct.png)


Запуск:

![Результаты 1](docs/aux/b1_result.png)

> Наиболее быстрой оказалась реализация v2.3

#### Хеширование файлов от 100 до 1000 МБ
Использован файл обьемом 777 МБ (название - f777). 

Проверка корректности работы реализаций:

![Проверка корректности 2](docs/aux/b2_correct.png)

Запуск:

![Результаты 2](docs/aux/b2_result.png)

> Наиболее быстрой оказалась реализация v2.3


#### Хеширование файлов от 1000 МБ
Использован файл обьемом 7777 МБ (название - f7777). 


Проверка корректности работы реализаций:

![Проверка корректности 3](docs/aux/b3_correct.png)

Запуск

![Результаты 3](docs/aux/b3_result.png)

> Наиболее быстрой оказалась реализация v2.3

## Результаты

Наиболее производительная программа - реализация версии 2.3, в среднем <b>опережающая</b> [OpenSSL GOST Engine](https://github.com/gost-engine/engine) на *4-5%*,  [реализацию Алексея Дягтерева](https://github.com/adegtyarev/streebog) на *27-28%*, версии 2.2 и 2.1 - на *9-10%* и *25-26%* соотвественно.

|       Реализация        | Место | Отставание <br>от вышестоящего (%) | Отставание от <br>наиболее быстрого (%) |
| :---------------------: | :---: | :--------------------------------: | :-------------------------------------: |
|   v2.3 <br>(metaprog)   |   1   |                 0                  |                    0                    |
| OpenSSL <br>GOST Engine |   2   |                 5                  |                    5                    |
|   v2.2<br>(metaprog)    |   3   |               5<br>                |                   10                    |
|          v2.1           |   4   |                 15                 |                   25                    |
|       adegtyarev        |   5   |                 2                  |                   27                    |
